<Page x:Class="Coach_search.MVVM.View.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="MainPage">
    <Grid Background="{StaticResource BackgroundColor}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Боковое меню -->
        <Border Grid.Column="0" Background="White" Padding="16" BorderThickness="0,0,1,0" BorderBrush="#E0E0E0">
            <StackPanel>
                <TextBlock Text="TutorSearch" FontSize="22" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" Margin="0,0,0,24"/>
                <Button Content="Главная" Command="{Binding NavigateCommand}" CommandParameter="MainPage" Style="{StaticResource PrimaryButton}" Margin="0,8" Height="30"/>
                <Button Content="Поиск" Command="{Binding NavigateCommand}" CommandParameter="SearchPage" Style="{StaticResource PrimaryButton}" Margin="0,8" Height="30"/>
                <Button Content="Расписание" Command="{Binding NavigateCommand}" CommandParameter="SchedulePage" Style="{StaticResource PrimaryButton}" Margin="0,8" Height="30"/>
                <Button Content="Сообщения" Command="{Binding NavigateCommand}" CommandParameter="MessagesPage" Style="{StaticResource PrimaryButton}" Margin="0,8" Height="30"/>
                <Button Content="Личный кабинет репетитора" Command="{Binding NavigateCommand}" CommandParameter="SettingsPage" Style="{StaticResource PrimaryButton}" Margin="0,8" Height="30"/>
                <Button Content="Личный кабинет клиента" Command="{Binding NavigateCommand}" CommandParameter="ClientProfilePage" Style="{StaticResource PrimaryButton}" Margin="0,8" Height="30"/>
                <Button Content="Выход" Command="{Binding LogoutCommand}" Style="{StaticResource PrimaryButton}" Margin="0,8" Height="30"/>
            </StackPanel>
        </Border>

        <!-- Основной контент -->
        <Grid Grid.Column="1" Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Поиск -->
            <StackPanel Grid.Row="0" Margin="0,0,0,24">
                <TextBlock Text="Найдите репетитора" Style="{StaticResource HeaderText}"/>
                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                    <ComboBox Width="180" Margin="0,0,12,0" ItemsSource="{Binding Subjects}" SelectedItem="{Binding SearchSubject}" Style="{DynamicResource MahApps.Styles.ComboBox}" mah:TextBoxHelper.Watermark="Предмет"/>
                    <ComboBox Width="180" Margin="0,0,12,0" ItemsSource="{Binding Ratings}" SelectedItem="{Binding SearchRating}" Style="{DynamicResource MahApps.Styles.ComboBox}" mah:TextBoxHelper.Watermark="Рейтинг"/>
                    <ComboBox Width="180" Margin="0,0,12,0" ItemsSource="{Binding PriceRanges}" SelectedItem="{Binding SearchPriceRange}" Style="{DynamicResource MahApps.Styles.ComboBox}" mah:TextBoxHelper.Watermark="Цена"/>
                    <Button Content="Найти" Command="{Binding SearchCommand}" Style="{StaticResource PrimaryButton}"/>
                </StackPanel>
            </StackPanel>

            <!-- Список репетиторов -->
            <ScrollViewer Grid.Row="1" Style="{StaticResource CustomScrollViewer}" FocusManager.IsFocusScope="True">
                <ListBox ItemsSource="{Binding Tutors}" SelectedItem="{Binding SelectedTutor}" Style="{StaticResource ListBoxStyle}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource CardStyle}" HorizontalAlignment="Stretch">
                                <Grid HorizontalAlignment="Stretch">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Аватар -->
                                    <Ellipse Width="80" Height="80" Margin="0,0,20,0" HorizontalAlignment="Left">
                                        <Ellipse.Fill>
                                            <ImageBrush ImageSource="{Binding AvatarPath, FallbackValue=/MVVM/View/images/icons/defaultavatar.png}"/>
                                        </Ellipse.Fill>
                                    </Ellipse>

                                    <!-- Информация -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}" Style="{StaticResource SubHeaderText}" FontSize="18" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Subject}" Style="{StaticResource BodyText}" FontSize="15"/>
                                        <TextBlock Text="{Binding PricePerHour, StringFormat={}{0} ₽/ч}" Style="{StaticResource BodyText}" FontSize="15"/>
                                        <TextBlock Text="{Binding Rating, StringFormat=Рейтинг: {0:F1} ★}" Style="{StaticResource BodyText}" FontSize="15"/>
                                        <TextBlock Text="{Binding Description}" Style="{StaticResource BodyText}" FontSize="14" TextTrimming="CharacterEllipsis" MaxHeight="50"/>
                                    </StackPanel>

                                    <!-- Кнопки -->
                                    <StackPanel Grid.Column="2" VerticalAlignment="Center" Orientation="Vertical">
                                        <Button Content="Записаться" 
                                                Command="{Binding DataContext.EnrollCommand, RelativeSource={RelativeSource AncestorType=ListBox}}" 
                                                CommandParameter="{Binding}" 
                                                Style="{StaticResource SecondaryButton}" 
                                                Margin="0,0,0,8" 
                                                Width="120" 
                                                Height="40"/>
                                        <Button Content="Подробнее" 
                                                Command="{Binding DataContext.ShowTutorDetailsCommand, RelativeSource={RelativeSource AncestorType=ListBox}}" 
                                                CommandParameter="{Binding}" 
                                                Style="{StaticResource PrimaryButton}" 
                                                Width="120" 
                                                Height="40"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </ScrollViewer>
        </Grid>
    </Grid>
</Page>